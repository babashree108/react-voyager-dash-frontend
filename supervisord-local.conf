[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:mysql]
command=/usr/sbin/mysqld --user=mysql --datadir=/var/lib/mysql
autostart=true
autorestart=true
priority=1
stdout_logfile=/var/log/mysql-stdout.log
stderr_logfile=/var/log/mysql-stderr.log
user=mysql
startsecs=5

[program:initdb]
command=/bin/bash -lc "for i in {1..60}; do mysqladmin ping --silent && break || sleep 1; done; mysql -u root -e \"CREATE DATABASE IF NOT EXISTS nxtClass108; CREATE USER IF NOT EXISTS 'nxtclass_user'@'localhost' IDENTIFIED BY 'nxtclass_pass_2024'; CREATE USER IF NOT EXISTS 'nxtclass_user'@'%%' IDENTIFIED BY 'nxtclass_pass_2024'; GRANT ALL PRIVILEGES ON nxtClass108.* TO 'nxtclass_user'@'localhost'; GRANT ALL PRIVILEGES ON nxtClass108.* TO 'nxtclass_user'@'%%'; FLUSH PRIVILEGES;\""
autostart=true
autorestart=false
startretries=3
priority=2
stdout_logfile=/var/log/initdb-stdout.log
stderr_logfile=/var/log/initdb-stderr.log

[program:backend]
command=java -Xmx512m -Xms256m -jar /app/backend/target/backend-0.0.1-SNAPSHOT.jar
directory=/app/backend
autostart=true
autorestart=true
priority=3
startretries=10
startsecs=10
stdout_logfile=/var/log/backend-stdout.log
stderr_logfile=/var/log/backend-stderr.log
environment=
    JWT_SECRET="nxtclass_jwt_secret_key_for_local_testing_only_minimum_256_bits_required_here",
    JWT_EXPIRATION="3600000",
    SPRING_DATASOURCE_URL="jdbc:mysql://localhost:3306/nxtClass108?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true",
    SPRING_DATASOURCE_USERNAME="nxtclass_user",
    SPRING_DATASOURCE_PASSWORD="nxtclass_pass_2024",
    CORS_ALLOWED_ORIGINS="http://localhost,http://127.0.0.1",
    LOG_LEVEL="INFO"

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autostart=true
autorestart=true
priority=4
stdout_logfile=/var/log/nginx-stdout.log
stderr_logfile=/var/log/nginx-stderr.log
